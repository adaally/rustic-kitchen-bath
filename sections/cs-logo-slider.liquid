{% style %}
    #shopify-section-{{ section.id }} {
        margin-top: {{ section.settings.top_margin }}rem;
        margin-bottom: {{ section.settings.bottom_margin }}rem;
        padding-top: {{ section.settings.top_padding }}rem;
        padding-bottom: {{ section.settings.bottom_padding }}rem;
    }
    #shopify-section-{{ section.id }} .cs-image-desktop {
      display: block;
    }
    #shopify-section-{{ section.id }} .cs-image-mobile {
      display: none;
    }
    @media screen and (max-width: 768px) {
      #shopify-section-{{ section.id }} {
          margin-top: {{ section.settings.top_margin | divided_by: 3 }}rem;
          margin-bottom: {{ section.settings.bottom_margin | divided_by: 3 }}rem;
          padding-top: {{ section.settings.top_padding | divided_by: 3 }}rem;
          padding-bottom: {{ section.settings.bottom_padding | divided_by: 3 }}rem;
      }
    }
{% endstyle %}

<div class="cs-container">
  <div class="wrap_title  des_title_12 sub_title_size_21">
    {% if section.settings.heading != blank %}		  
      <h2 class="section-title tc pr flex fl_center al_center fs__24 title_3"><span class="mr__10 ml__10"><div class="h4">{{ section.settings.heading }}</div></span></h2>
    {% endif %}
    {% if section.settings.subheading != blank %}
		  <span class="dn tt_divider"><span></span><i class="dn clprfalse title_12 la-"></i><span></span></span><span class="section-subtitle db tc">{{ section.settings.subheading }}</span>
    {% endif %}
  </div>
  <div class="cs-grid">
    <div class="swiper mySwiper-{{ section.id }}">
      <div class="swiper-wrapper">
        {% for block in section.blocks %}
          <div class="swiper-slide">            
            <div class="cs-image">
              {% if block.settings.link != blank %}
                <a href="{{ block.settings.link }}">
                  {{ block.settings.image | image_url: width: 600 | image_tag: widths: '540, 480, 360' }}
                </a>
              {% else %}
                {{ block.settings.image | image_url: width: 600 | image_tag: widths: '540, 480, 360' }}
              {% endif %}
            </div>
          </div>
        {% endfor %}          
      </div>
      <div class="swiper-pagination"></div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div>
  </div>
</div>
<script>
  function updateAriaLabel(swiperLogo) {
    const total = swiperLogo.slides.length;
    swiperLogo.slides.forEach((slide, index) => {
      slide.setAttribute("aria-label", `Logo ${index + 1} of ${total}`)
    });
  }
  function updateTabIndex(swiperLogo) {
    // Reset all links to tabindex -1
    swiperLogo.slides.forEach(slide => {
      const link = slide.querySelector("a");
      if (link) link.setAttribute("tabindex", "-1");
    });

    // Enable only the visible ones
    swiperLogo.slides.forEach(slide => {
      if (slide.classList.contains("swiper-slide-visible")) {
        const link = slide.querySelector("a");
        if (link) link.setAttribute("tabindex", "0");
      }
    });

    // Force navigation buttons to be skipped
    const prevBtn = swiperLogo.navigation?.prevEl;
    const nextBtn = swiperLogo.navigation?.nextEl;
    if (prevBtn) prevBtn.setAttribute("tabindex", "-1");
    if (nextBtn) nextBtn.setAttribute("tabindex", "-1");
  }
  document.addEventListener("DOMContentLoaded", () => {
    function initSlide() {  
      var perView = {{ section.settings.slides_per_view }}  
      var swiperLogo = new Swiper(".mySwiper-{{ section.id }}", {    
        spaceBetween: 14,
        pagination: {
          el: ".swiper-pagination",
          clickable: true
        },
        navigation: {
          nextEl: ".swiper-button-next",
          prevEl: ".swiper-button-prev",
        },
        breakpoints: {
          540: {
            slidesPerView: 2,
            slidesPerGroup: 2,
            spaceBetween: 4,
          },
          820: {
            slidesPerView: 3,
            slidesPerGroup: 3,
            spaceBetween: 8,
          },
          999: {
            spaceBetween: 10,
            slidesPerView: perView,
            slidesPerGroup: perView,
          }
        },
        watchSlidesProgress: true,
        watchSlidesVisibility: true,
        on: {
          init: {

            updateTabIndex(swiperLogo);
          },
          slideChange: {
            updateTabIndex(swiperLogo);
          }
        }
      })
    }

    initSlide()

    document.addEventListener("shopify:section:load", function(event) {
      initSlide()
    })
  })
</script>

{% schema %}
{
    "name": "Custom Logo Slider",
    "class": "cs-logo-slider",
    "settings": [     
      {
        "type": "text",
        "id": "heading",
        "label": "Heading"
      },
      {
        "type": "range",
        "id": "slides_per_view",
        "min": 1,
        "max": 12,
        "step": 1,        
        "label": "Slides Per View",
        "default": 6
      },
      {
        "type": "textarea",
        "id": "subheading",
        "label": "Subheading"
      },
      {
        "type": "header",
        "content": "Margins and Paddings"
      }, 
      {
        "type": "range",
        "id": "top_margin",
        "label": "Top Margin",
        "min": 0,
        "max": 100,
        "unit": "rem",
        "step": 1,
        "default": 0
      },
      {
        "type": "range",
        "id": "bottom_margin",
        "label": "Bottom Margin",
        "min": 0,
        "max": 100,
        "unit": "rem",
        "step": 1,
        "default": 0
      },
      {
        "type": "range",
        "id": "top_padding",
        "label": "Top Padding",
        "min": 0,
        "max": 100,
        "unit": "rem",
        "step": 1,
        "default": 0
      },
      {
        "type": "range",
        "id": "bottom_padding",
        "label": "Bottom Padding",
        "min": 0,
        "max": 100,
        "unit": "rem",
        "step": 1,
        "default": 0
      }
    ],
    "blocks": [
      {
        "type": "image",
        "name": "Image",
        "settings": [          
          {
            "type": "image_picker",
            "id": "image",
            "label": "Image Desktop"
          },
          {
            "type": "url",
            "id": "link",
            "label": "Image Link"
          },
          {
            "type": "checkbox",
            "id": "open_link",
            "label": "Open link in new tab",
            "default": true
          }
        ]
      }      
    ],
    "presets": [
        {
            "name": "Custom Logo Slider"
        }
    ]
}
{% endschema %}